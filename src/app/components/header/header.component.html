<div
  class="sticky top-0 z-40 bg-white dark:bg-zinc-900 border-b border-gray-200 dark:border-zinc-700 shadow-sm"
>
  <div class="flex items-center justify-between px-4 py-3 max-w-7xl mx-auto">
    <div class="flex items-center gap-3">
      @if (isBack) {
        <button
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-zinc-800 transition-colors"
          (click)="goBack()"
        >
          <mat-icon class="!w-5 !h-5 !text-xl textNormal" fontIcon="arrow_back" />
        </button>
      }

      <div class="flex flex-col">
        <h1 class="text-lg font-semibold textNormal">{{ title }}</h1>
        @if (subtitle) {
          <p class="text-sm textMuted">{{ subtitle }}</p>
        }
      </div>
    </div>

    <div class="flex items-center gap-2">
      <!-- <button
        class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-zinc-800 transition-colors relative"
        title="Notifications"
      >
        <mat-icon class="!w-5 !h-6 !text-xl textMuted" fontIcon="notifications_none" />
        <div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></div>
      </button> -->

      <button
        class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-zinc-800 transition-colors"
        (click)="toggleTheme()"
        [title]="themeVal === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'"
      >
        @if (themeVal === "dark") {
          <mat-icon class="!w-5 !h-6 !text-xl textMuted" fontIcon="light_mode" />
        } @else {
          <mat-icon class="!w-5 !h-6 !text-xl textMuted" fontIcon="dark_mode" />
        }
      </button>

      <button
        class="flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-zinc-800 transition-colors"
        (click)="toggleUserMenu()"
      >
        <div
          class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium"
        >
          {{ profile ? profile.name.slice(0, 1) : "U"
          }}{{ profile ? profile.lastName.slice(0, 1) : "" }}
        </div>
      </button>
    </div>
  </div>
</div>

@if (showUserMenu) {
  <div
    class="absolute top-16 right-4 z-50 bg-white dark:bg-zinc-800 rounded-xl shadow-lg border border-gray-200 dark:border-zinc-700 min-w-[200px]"
  >
    <div class="p-3 border-b border-gray-200 dark:border-zinc-700">
      <p class="font-medium textNormal">
        {{ profile ? profile.name : "User" }} {{ profile ? profile.lastName : "" }}
      </p>
      <p class="text-sm textMuted">{{ profile ? profile.user.email : "" }}</p>
    </div>

    <div class="py-2">
      <button
        class="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-zinc-700 transition-colors"
        routerLink="/profile"
        [queryParams]="{ id: userId }"
        (click)="closeUserMenu()"
      >
        <mat-icon class="!w-5 !h-6 !text-xl textMuted" fontIcon="person" />
        <span class="textNormal">Profile</span>
      </button>

      <button
        class="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-zinc-700 transition-colors"
        routerLink="/categories"
        (click)="closeUserMenu()"
      >
        <mat-icon class="!w-5 !h-6 !text-xl textMuted" fontIcon="category" />
        <span class="textNormal">Categories</span>
      </button>

      <button
        class="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-zinc-700 transition-colors"
        routerLink="/about"
        (click)="closeUserMenu()"
      >
        <mat-icon class="!w-5 !h-6 !text-xl textMuted" fontIcon="info_outlined" />
        <span class="textNormal">About</span>
      </button>

      <!-- <button
        class="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-zinc-700 transition-colors"
        routerLink="/profile/edit_profile"
        (click)="closeUserMenu()"
      >
        <mat-icon class="!w-5 !h-6 !text-xl textMuted" fontIcon="settings" />
        <span class="textNormal">Settings</span>
      </button> -->

      <hr class="my-2 border-gray-200 dark:border-zinc-700" />

      <button
        class="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors"
        (click)="logout()"
      >
        <mat-icon class="!w-5 !h-6 !text-xl" fontIcon="logout" />
        <span>Sign out</span>
      </button>
    </div>
  </div>
}

@if (showUserMenu) {
  <div class="fixed inset-0 z-40" (click)="closeUserMenu()"></div>
}
