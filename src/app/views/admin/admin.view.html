<div class="lg:hidden">
  <button
    class="fixed top-16 left-4 z-40 p-2 bg-white dark:bg-zinc-800 rounded-lg shadow-lg border border-gray-200 dark:border-zinc-700"
    (click)="toggleMobileSidebar()"
    [class.left-72]="showMobileSidebar"
  >
    <mat-icon class="!w-5 !h-5 !text-xl textNormal" fontIcon="menu" />
  </button>
</div>

<div class="max-w-7xl mx-auto px-4 lg:px-6 py-4 lg:py-8">
  <div class="flex flex-col lg:flex-row gap-4 lg:gap-8">
    <div
      class="w-full lg:w-80 flex-shrink-0 lg:hidden"
      [class.flex]="showMobileSidebar"
      [class.hidden]="!showMobileSidebar"
    >
      @if (showMobileSidebar) {
        <div class="fixed inset-0 z-30 bg-black/50 lg:hidden" (click)="closeMobileSidebar()"></div>
      }

      <div
        class="fixed lg:relative top-0 left-0 lg:left-auto right-0 lg:w-full z-40 lg:z-auto bg-white dark:bg-zinc-800 rounded-xl lg:rounded-xl shadow-lg border border-gray-200 dark:border-zinc-700 overflow-hidden h-full lg:h-auto max-w-sm lg:max-w-none"
      >
        <div class="p-4 border-b border-gray-200 dark:border-zinc-700">
          <h2 class="text-lg font-semibold textNormal">Data Types</h2>
        </div>

        <div class="divide-y divide-gray-100 dark:divide-zinc-700 max-h-[calc(100vh-200px)] lg:max-h-none overflow-y-auto">
          @for (type of dataTypes; track type.id) {
            <button
              class="w-full flex items-center gap-3 p-4 text-left hover:bg-gray-50 dark:hover:bg-zinc-700 transition-colors"
              [class.bg-blue-50]="selectedType === type.id"
              [class.dark:bg-blue-900/30]="selectedType === type.id"
              (click)="selectDataType(type.id)"
            >
              <mat-icon
                class="!w-5 !h-5 !text-xl"
                [class.text-blue-600]="selectedType === type.id"
                [class.dark:text-blue-400]="selectedType === type.id"
                [class.text-gray-500]="selectedType !== type.id"
                [class.dark:text-zinc-400]="selectedType !== type.id"
                [fontIcon]="type.icon"
              />
              <div class="flex-1">
                <div class="text-sm font-medium textNormal">{{ type.label }}</div>
                <div class="flex items-center justify-between mt-1">
                  <span class="text-xs textMuted">{{ type.count }} items</span>
                </div>
              </div>
              <div class="flex flex-row gap-x-1">
                @if (loading) {
                  <mat-icon class="!w-5 !h-5 !text-xl text-blue-500 animate-spin" fontIcon="sync" />
                }
                <mat-icon
                  class="!w-5 !h-5 !text-xl textMuted"
                  [class.rotate-90]="selectedType === type.id"
                  fontIcon="chevron_right"
                />
              </div>
            </button>
          }
        </div>
      </div>
    </div>

    <div class="hidden lg:block w-80 flex-shrink-0">
      <div class="bg-white dark:bg-zinc-800 rounded-xl shadow-lg border border-gray-200 dark:border-zinc-700 overflow-hidden">
        <div class="p-4 border-b border-gray-200 dark:border-zinc-700">
          <h2 class="text-lg font-semibold textNormal">Data Types</h2>
        </div>

        <div class="divide-y divide-gray-100 dark:divide-zinc-700">
          @for (type of dataTypes; track type.id) {
            <button
              class="w-full flex items-center gap-3 p-4 text-left hover:bg-gray-50 dark:hover:bg-zinc-700 transition-colors"
              [class.bg-blue-50]="selectedType === type.id"
              [class.dark:bg-blue-900/30]="selectedType === type.id"
              (click)="selectDataType(type.id)"
            >
              <mat-icon
                class="!w-5 !h-5 !text-xl"
                [class.text-blue-600]="selectedType === type.id"
                [class.dark:text-blue-400]="selectedType === type.id"
                [class.text-gray-500]="selectedType !== type.id"
                [class.dark:text-zinc-400]="selectedType !== type.id"
                [fontIcon]="type.icon"
              />
              <div class="flex-1">
                <div class="text-sm font-medium textNormal">{{ type.label }}</div>
                <div class="flex items-center justify-between mt-1">
                  <span class="text-xs textMuted">{{ type.count }} items</span>
                </div>
              </div>
              <div class="flex flex-row gap-x-1">
                @if (loading) {
                  <mat-icon class="!w-5 !h-5 !text-xl text-blue-500 animate-spin" fontIcon="sync" />
                }
                <mat-icon
                  class="!w-5 !h-5 !text-xl textMuted"
                  [class.rotate-90]="selectedType === type.id"
                  fontIcon="chevron_right"
                />
              </div>
            </button>
          }
        </div>
      </div>
    </div>

    <div class="flex-1 h-[calc(100vh-220px)] overflow-y-auto">
      <div class="bg-white dark:bg-zinc-800 rounded-xl shadow-lg border border-gray-200 dark:border-zinc-700">
        <div class="p-4 lg:p-6 border-b border-gray-200 dark:border-zinc-700">
          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div>
              <h2 class="text-xl font-bold textNormal">{{ getSelectedTypeLabel() }}</h2>
              <p class="text-sm textMuted">{{ getCurrentData().length }} total records</p>
            </div>
            <div class="flex flex-col lg:flex-row gap-2 lg:items-center">
              <div class="relative">
                <button
                  mat-button
                  class="flex items-center gap-2 border border-gray-300 dark:border-zinc-600 rounded px-3 py-2 text-sm"
                  [matMenuTriggerFor]="filterMenu"
                >
                  <mat-icon class="!w-5 !h-5 !text-xl" [fontIcon]="getCurrentFilterIcon()" />
                  {{ getCurrentFilterLabel() }}
                  <mat-icon class="!w-4.5 !h-4.5 !text-lg ml-1" fontIcon="keyboard_arrow_down" />
                </button>
                <mat-menu #filterMenu="matMenu" class="bg-white dark:bg-zinc-800">
                  @for (filterType of filterOptions; track filterType.value) {
                    <button
                      mat-menu-item
                      class="!flex !items-center !gap-1"
                      (click)="setFilter(filterType.value)"
                    >
                      <mat-icon class="!w-5 !h-5 !text-xl" [fontIcon]="filterType.icon" />
                      <span>{{ filterType.label }}</span>
                    </button>
                  }
                </mat-menu>
              </div>
              <button
                mat-button
                class="bg-blue-600 hover:bg-blue-700 text-white"
                (click)="loadAdminData()"
                [disabled]="loading"
              >
                <mat-icon class="!w-5 !h-5 !text-xl mr-2" [ngClass]="loading ? 'animate-spin' : ''" fontIcon="sync" />
                Refresh
              </button>
            </div>
          </div>
        </div>

        <div class="p-4 lg:p-6">
          @if (loading) {
            <div class="flex items-center justify-center py-16">
              <mat-icon class="!w-7.5 !h-7.5 !text-3xl text-blue-500 animate-spin" fontIcon="sync" />
              <span class="ml-3 textNormal">Loading data...</span>
            </div>
          } @else if (getCurrentData().length === 0) {
            <div class="text-center py-16">
              <mat-icon class="!w-16 !h-16 !text-4xl text-gray-300" fontIcon="inbox" />
              <h3 class="mt-4 text-lg font-medium text-gray-500">No records found</h3>
              <p class="mt-2 text-sm textMuted">No {{ getSelectedTypeLabel().toLowerCase() }} data available</p>
            </div>
          } @else {
            <div class="grid grid-cols-1 gap-4">
              @for (item of getCurrentData(); track item.id; let i = $index) {
                <mat-card class="p-4 lg:p-6 hover:shadow-lg transition-shadow">
                  <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-4">
                    <div class="flex items-center gap-3">
                      <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                        <mat-icon class="!w-5 !h-5 !text-xl text-blue-600 dark:text-blue-400" fontIcon="article" />
                      </div>
                      <div>
                        <h4 class="font-semibold textNormal">Record {{ item.id }}</h4>
                        <p class="text-sm textMuted">#{{ i + 1 }}</p>
                      </div>
                    </div>
                    <div class="flex items-center gap-2 flex-shrink-0">
                      @if (item.isDeleted) {
                        <mat-chip class="!bg-red-100 !text-red-600 dark:!bg-red-900/30 dark:!text-red-400 !h-9">
                          <div class="flex flex-row items-center gap-x-2">
                            <mat-icon class="!w-5 !h-5 !text-xl" fontIcon="delete" />
                            <span>Deleted</span>
                          </div>
                        </mat-chip>
                      } @else {
                        <mat-chip class="!bg-green-100 !text-green-600 dark:!bg-green-900/30 dark:!text-green-400 !h-9">
                          <div class="flex flex-row items-center gap-x-2">
                            <mat-icon class="!w-5 !h-5 !text-xl" fontIcon="check_circle" />
                            <span>Active</span>
                          </div>
                        </mat-chip>
                      }
                      <button
                        mat-button
                        class="!min-w-0 !w-9 !h-9 !p-0 textMuted"
                        [matMenuTriggerFor]="actionMenu"
                      >
                        <mat-icon class="!w-5 !h-5 !text-lg textMuted" fontIcon="more_vert" />
                      </button>
                      <mat-menu #actionMenu="matMenu" class="bg-white dark:bg-zinc-800">
                        <button
                          mat-menu-item
                          class="!text-red-600 dark:!text-red-400"
                          (click)="deleteRecord(item)"
                        >
                          <mat-icon class="!w-5 !h-5 !text-xl" fontIcon="delete_forever" />
                          <span>Permanently Delete</span>
                        </button>
                      </mat-menu>
                    </div>
                  </div>

                  <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 text-sm">
                    @for (prop of getDataProperties(item); track prop.key) {
                      @if (prop.key !== 'id') {
                        <div class="overflow-hidden">
                          <span class="font-medium textMuted">{{ prop.key }}:</span>
                          <div class="mt-1 break-words">
                            @if (prop.key === 'createdAt' || prop.key === 'updatedAt') {
                              <span class="textNormal">{{ formatDate(prop.value) }}</span>
                            } @else if (prop.value === null || prop.value === '') {
                              <span class="text-gray-400">—</span>
                            } @else if (typeof prop.value === 'boolean') {
                              <span [class]="prop.value ? 'text-green-600' : 'text-red-600'">
                                {{ prop.value ? 'Yes' : 'No' }}
                              </span>
                            } @else if (prop.key === 'priority') {
                              <span class="textNormal capitalize">{{ prop.value }}</span>
                            } @else if (typeof prop.value == "object" && prop.value.length >= 0) {
                              @for (item of prop.value; track $index) {
                                <span class="textNormal">{{ item | json }}</span>
                              }
                            } @else if (typeof prop.value == "object") {
                              <span class="textNormal">{{ prop.value | json }}</span>
                            } @else {
                              <span class="textNormal">{{ prop.value }}</span>
                            }
                          </div>
                        </div>
                      }
                    }
                  </div>
                </mat-card>
              }
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
